import{createCookie,readCookie}from"https://cdn.digitalbutlers.me/projects/immperium/scripts/utils/cookies.js";class EthApi{constructor(){this.config={ethUrl:"https://api.imperiumchain.com/site/eth-staking",cookieExpiresTime:.5},this.aprFields=document.querySelectorAll('[data-api-name="apr"]'),this.stakedField=document.querySelector('[data-api-name="staked"]'),this.stakedSumField=document.querySelector('[data-api-name="stakedsum"]'),this.validatorsField=document.querySelector('[data-api-name="validators"]'),this.apr=readCookie("apr"),this.staked=readCookie("staked"),this.stakedSum=readCookie("stakedsum"),this.validators=readCookie("validators")}init=()=>{(this.aprFields.length||this.stakedField||this.stakedSumField||this.stakedSumField)&&window.addEventListener("DOMContentLoaded",this.getContentFromLocal)};getContentFromLocal=()=>{this.apr&&this.staked&&this.stakedSum&&this.validators?(this.aprFields.forEach((t=>{this.addContent(t,this.apr)})),this.addContent(this.stakedField,this.staked),this.addContent(this.stakedSumField,this.stakedSum),this.addContent(this.validatorsField,this.validators)):this.getContentFromApi()};getContentFromApi=()=>{fetch(this.config.ethUrl).then((t=>t.json())).then((t=>{this.apr=`${t.apr.toFixed(2)}%`,this.staked=`${this.separateNumber(t.total_eth_staked.toFixed(2))}`,this.stakedSum=`$${this.separateNumber(t.total_eth_staked_in_usd.toFixed(0))}`,this.validators=t.active_validators,this.apr&&(createCookie("apr",this.apr,this.config.cookieExpiresTime),this.aprFields.forEach((t=>{this.addContent(t,this.apr)}))),this.staked&&(createCookie("staked",this.staked,this.config.cookieExpiresTime),this.addContent(this.stakedField,this.staked)),this.stakedSum&&(createCookie("stakedsum",this.stakedSum,this.config.cookieExpiresTime),this.addContent(this.stakedSumField,this.stakedSum)),this.validators&&(createCookie("validators",this.validators,this.config.cookieExpiresTime),this.addContent(this.validatorsField,this.validators))}))};addContent=(t,e)=>{t.textContent=e};separateNumber=(t,e=",")=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,`${e}`)}const ethApi=new EthApi;ethApi.init();